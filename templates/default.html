{% extends 'base_site.html' %}
{% load crispy_forms_tags %}
{% load i18n %}
{% load static %}
{% block title %}{% trans "Log In Page" %}{% endblock %}
{% get_current_language as CURRENT_LANGUAGE %}
{% get_available_languages as LANGUAGES %}

{% block extra_styles %}
    <style>

        .login-body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0; /* Enlève les marges par défaut */
            background: #3A3A3A; /* Ou la couleur de fond de votre choix */
        }

        .login-container {
            background: #3A3A3A; /* Updated background color */
            color: white;
            width: 100%; /* ou une largeur fixe, si vous préférez */
            max-width: 400px; /* ou la largeur maximale que vous souhaitez pour votre conteneur */
            margin: auto; /* assurez-vous que le conteneur reste centré même dans une fenêtre de taille supérieure */
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* pour l'effet de profondeur */
            border-radius: 5px; /* pour des coins arrondis */
        }

        .login-form h2 {
            margin-bottom: 20px;
            color: white;
            text-align: center;
        }

        .btn-login {
            width: 100%;
            padding: 10px;
            border: none;
            background: #009578;
            color: white;
            margin-top: 15px;
            cursor: pointer;
        }

        .btn-login:hover {
            background: #007a63;
        }

        .login-links p {
            text-align: center;
            margin-top: 10px;
        }

        .login-links a {
            color: #009578;
            text-decoration: none;
        }

        .login-links a:hover {
            text-decoration: underline;
        }

        .logo {
            display: block; /* Centers the logo */
            margin: 0 auto 20px; /* Adds space below the logo */
            max-width: 150px; /* Adjust the size as needed */
            height: auto;
        }

        .content-wrapper {
            display: flex;
            flex-direction: column; /* Stack elements vertically */
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Take full height of the viewport */
            margin: 0;
            {#background: #212529;#}
        }
        .content-wrapper h1,p{
            color: #009578;
        }

        .login-body h1, .login-body p {
            text-align: center;
            margin: 10px 0; /* Adjust spacing as needed */
        }

         .sidebar {
             width: 250px; /* ou la largeur que vous souhaitez */
             position: fixed;
             top: 0;
             left: 0;
             height: 100vh;
             background: #333;
             color: white;
             box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
         }

        .sidebar-header {
            padding: 20px;
            background: #3A3A3A; /* Un peu plus clair que la sidebar pour le distinguer */
            text-align: center;
        }

        .sidebar-header img {
            max-width: 100px; /* Adaptez à la taille de votre logo */
            height: auto;
            margin-bottom: 10px;
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav .nav-item {
            padding: 10px 20px;
        }

        .sidebar-nav .nav-item .nav-link {
            color: white;
            text-decoration: none;
            display: block;
        }

        .sidebar-nav .nav-item .nav-link:hover {
            background: #555; /* Un peu plus clair pour l'effet hover */
        }

        #sidebar-toggle-btn {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background-color: #333333;
        }
        #main-content {
            padding-left: 250px; /* Espace pour la sidebar */
        }

        #sidebar-wrapper.hidden {
            left: -250px; /* Cache la sidebar */
            transition: left 0.3s;
        }

        .footer {
            text-align: center;
            margin-top: 50px; /* adjust as needed */
            font-size: 0.8em; /* smaller font size for footnotes */
            color: #666; /* a lighter color */
        }

        .footnote {
            margin-top: 20px; /* spacing above the footnote */
        }
    </style>
{% endblock %}

{% block sidebar %}
        <button class="btn btn-primary" id="sidebar-toggle-btn">&#9776; </button>
        <!-- Logo et toggle pour le mode sombre/clair -->
        <div class="sidebar-header">
            <img src="{% static 'images/logo.svg' %}" alt="Logo" />
        </div>
        <!-- Liens de la sidebar -->
        <ul class="sidebar-nav d-flex flex-column align-items-center mt-4"> <!-- Ajoutez ici une marge supérieure -->
            <form method="post" class="w-100 text-center mb-5"> <!-- Ajoutez une marge en bas si nécessaire -->
                {% csrf_token %}
                <div class="form-group">
                    <div class="d-flex align-items-center justify-content-center">
                        <span class="theme-switch-title mr-2">{% trans "Dark Mode:" %}</span>
                        <div class="custom-control custom-switch">
                            <input type="checkbox" id="displayPanel" class="custom-control-input">
                            <label class="custom-control-label" for="displayPanel">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </form>
            <li class="nav-item dropdown text-center">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownLanguages" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {% trans 'Languages' %}
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdownLanguages">
                    {% for code, name in LANGUAGES %}
                        <a class="dropdown-item" href="/{{ code }}/">{{ name }}
                        </a>
                    {% endfor %}
                </div>
            </li>
            <!-- Ajoutez d'autres liens ici -->
        </ul>

{% endblock %}

{% block content %}
    <div id="main-content" class="d-flex justify-content-center align-items-center" style="min-height: 100vh;">
        <div class="login-body">
            <div class="login-container">
                <img src="{% static 'images/logo.svg' %}" alt="Logo" class="logo">
                <h1>{% trans "Your Personalised Learning Platform" %}</h1>
                <p>{% trans "Connect and Thrive – Build Your Virtual Classroom Today!" %}</p>
                <form method="post" class="login-form">
                    {% csrf_token %}
                    <h2>{% trans "Welcome Back!" %}</h2>
                    {{ form|crispy }}
                    <button type="submit" class="btn-login">{% trans "Login" %}</button>
                </form>
                <div class="login-links">
                    <p><a href="{% url 'password_reset' %}">{% trans "Forgot your password?" %}</a></p>
                    <p>{% trans "Do you have an account?" %} <a href="{% url 'signup' %}">{% trans "Sign up" %}</a></p>
                </div>
            </div>
        </div>
    </div>
    <!-- Add your footnote here -->
    <div class="footer">
        <p class="footnote">
            {% trans 'Jokk is a word in Wolof which means to connect with someone. At jokk we believe that every individual has potential to share with the world. Our mission is to facilitate that sharing.' %}
        </p>
    </div>

{% endblock %}

{% block extra_scripts %}
{#    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>#}
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var sidebar = document.getElementById('sidebar-wrapper');
            var toggleBtn = document.getElementById('sidebar-toggle-btn');

            toggleBtn.addEventListener('click', function() {
                sidebar.classList.toggle('hidden');
            });
        });

        $(document).ready(function() {
            // Initialize the toggle switch based on the current theme
            var isDarkMode = $('body').hasClass('dark-mode');
            $('#displayPanel').prop('checked', isDarkMode);

            $('#displayPanel').change(function() {
                toggleDarkLight();
            });
        });

        function toggleDarkLight() {
            var isChecked = $('#displayPanel').is(':checked');

            $.ajax({
                type: 'POST',
                url: '{% url "change_theme" %}',
                data: {
                    'displayPanel': isChecked ? 'dark' : 'light',
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(response) {
                    console.log(response); // Debugging line
                    if(response.theme === "dark-mode") {
                        $('body').addClass('dark-mode').removeClass('light-mode');
                    } else {
                        $('body').addClass('light-mode').removeClass('dark-mode');
                    }
                    // Update the state of the switch to reflect the current theme
                    $('#displayPanel').prop('checked', response.theme === "dark-mode");
                }
            });
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        const csrftoken = getCookie('csrftoken');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
    </script>
{% endblock %}


